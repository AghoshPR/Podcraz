{% extends "user/base.html" %}
{% load static %}
{% block content %}
<style>
   
   .order-container {
    border: 5px solid #333;
    border-radius: 20px;
    margin-bottom: 20px;
    padding: 20px;
    background: #2c2c2c; /* Darker background */
    color: #f0f0f0; /* Light text for contrast */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3); /* Adjust shadow for the dark theme */
}

</style>

<div class="container py-4">

  {% if messages %}
  <div class="alert alert-dismissible fade show" role="alert">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
  </div>
  {% endif %}

  <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3">
          <div class="sidebar">
              <h5>Account</h5>
              <ul class="sidebar-menu">
                  <li><a href="{% url 'myprofile' %}">Profile</a></li>
                  <li><a href="{% url 'address' %}">Addresses</a></li>
                  <li><a href="{% url 'myorder' %}" class="active">Orders</a></li>
                  <li><a href="{% url 'wallet' %}">Wallet</a></li>
                  <li><a href="{% url 'coupon' %}">Coupon</a></li>
                  <li><a href="{% url 'changepass' %}">Change Password</a></li>
              </ul>
              <button class="logout-btn">LOGOUT</button>
          </div>
      </div>

      <!-- Main Content -->
      <div class="col-md-9">
          <div class="main-content">
              <h2>My Orders</h2>

              <!-- Order Filters -->
              <form method="GET">
                  <div class="order-filters">
                    <label>
                      <input type="radio" name="status" value="Delivered" {% if request.GET.status == 'Delivered' %}checked{% endif %}> All
                  </label>
                      <label>
                          <input type="radio" name="status" value="Delivered" {% if request.GET.status == 'Delivered' %}checked{% endif %}> Delivered
                      </label>
                      <label>
                          <input type="radio" name="status" value="Cancelled" {% if request.GET.status == 'Cancelled' %}checked{% endif %}> Cancelled
                      </label>
                      <label>
                          <input type="radio" name="status" value="Returned" {% if request.GET.status == 'Returned' %}checked{% endif %}> Returned
                      </label>
                      <a href="{% url 'myorder' %}" class="clear-filter">Clear all</a>
                  </div>
                  
              </form>

              <!-- Order List -->
              {% for order in orders %}
              <div class=" order-container">
                  <div class="order-items">
                      {% for item in order.items.all %}
                <a style="list-style-type: none; text-decoration: none;" href="{% url 'orderview' order.id  %}">
                      <div class="item-row">

                       
                        <img src="{{ item.product_variant.productimage_set.first.image_path.url }}" 
                            alt="{{ item.product_variant.product.name }}" class="item-image">
                       
                          <div class="item-details">
                              <div class="item-name">{{ item.product_variant.product.name }}</div>
                              
                          </div>
                      </div>
                </a>
                      {% endfor %}
                  </div>
                  <div class="order-info">
                      <div>
                          <p>Order Placed: {{ order.created_at|date:"M d Y" }}</p>
                          <p>Status: <span 
                            style="
                                {% if order.status == 'pending' %}color: brown;
                                {% elif order.status == 'shipped' %}color: blue;
                                {% elif order.status == 'delivered' %}color: green;
                                {% elif order.status == 'cancelled' %}color: red;
                                {% elif order.status == 'return_pending' %}color: orange;
                                {% elif order.status == 'return_approved' %}color: green;
                                {% elif order.status == 'return_rejected' %}color: red;
                                {% endif %}
                                font-weight: bold;">
                            {{ order.status|title }}
                        </span></p>
                        
                        {% if order.status == "delivered" %}
                        <a href="#" class="btn btn-primary">Download Invoice</a>
                        {% endif %}
                      </div>
                      
                      <div>
                          <p>Order ID: #{{ order.id }}</p>
                          <p>Total Price: â‚¹{{ order.total_price }}</p>
                      </div>
                  </div>

                  <div class="order-actions">
                    {% if order.status == "pending" or order.status == "processing" %}
                        <button class="btn-cancel" data-bs-toggle="modal" data-bs-target="#cancelOrderModal{{ order.id }}">
                            Cancel Order
                        </button>
                    {% elif order.status == "delivered" and not order.return_reason %}
                        <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#returnOrderModal{{ order.id }}">
                            Return Order
                        </button>
                    {% endif %}
                </div>
              </div>
              {% endfor %}

              <!-- Cancel Order Modal -->
              {% for order in orders %}
              <div class="modal fade" id="cancelOrderModal{{ order.id }}" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                      <form method="POST" action="{% url 'cancel_order' order.id %}">
                          {% csrf_token %}
                          <div class="modal-content">
                              <div class="modal-header">
                                  <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                  <div class="mb-3">
                                      <label for="cancellation_reason" class="form-label">Cancellation Reason</label>
                                      <textarea class="form-control" id="cancellation_reason" name="cancellation_reason" rows="3" required></textarea>
                                  </div>
                              </div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                  <button type="submit" class="btn btn-danger">Cancel Order</button>
                              </div>
                          </div>
                      </form>
                  </div>
              </div>


            <!-- Return Order Modal -->
            <div class="modal fade" id="returnOrderModal{{ order.id }}" tabindex="-1" aria-labelledby="returnOrderModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <form method="POST" action="{% url 'order_return' order.id %}">
                        {% csrf_token %}
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="returnOrderModalLabel">Return Order</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="return_reason_{{ order.id }}" class="form-label">Mention your Reason...</label>
                                    <textarea class="form-control" id="return_reason_{{ order.id }}" name="return_reason" rows="3" required></textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-info">Submit Return Request</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
              

              <!-- Pagination -->
              <div class="pagination">
                  {% if orders.has_previous %}
                  <a href="?page={{ orders.previous_page_number }}&status={{ request.GET.status }}">Previous</a>
                  {% endif %}
                  <span class="active">{{ orders.number }}</span>
                  {% if orders.has_next %}
                  <a href="?page={{ orders.next_page_number }}&status={{ request.GET.status }}">Next</a>
                  {% endif %}
              </div>
          </div>
      </div>
  </div>
</div>

<style>
  body {
      background-color: #f0f0f0;
  }
  .sidebar {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
  }
  .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 0;
  }
  .sidebar-menu li {
      padding: 8px 0;
      border-bottom: 1px solid #dee2e6;
  }
  .sidebar-menu li:last-child {
      border-bottom: none;
  }
  .sidebar-menu a {
      color: #333;
      text-decoration: none;
      display: block;
      padding: 8px 15px;
      border-radius: 4px;
  }
  .logout-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 4px;
      width: 100%;
      margin-top: 15px;
  }
  .main-content {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }
  .order-filters {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
  }
  .order-filters input[type="radio"] {
      margin-right: 5px;
  }
  .clear-filter {
      margin-left: auto;
      color: #007bff;
      text-decoration: none;
      font-size: 14px;
  }
  .order-container {
      border: 1px solid #dee2e6;
      border-radius: 8px;
      margin-bottom: 20px;
      padding: 20px;
      background: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  .item-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      align-items: center;
  }
  .item-image {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      object-fit: cover;
  }
  .item-details {
      flex-grow: 1;
  }
  .item-name {
      font-weight: bold;
      margin-bottom: 5px;
  }
  .item-quantity, .item-price {
      color: #666;
      font-size: 0.9em;
  }
  .order-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #dee2e6;
  }
  .order-info p {
      font-size: 1 em;
      font-weight: bold;
      color: #333;
      margin: 5px 0;
  }
  .order-actions {
      margin-top: 15px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
  }
  .btn-invoice, .btn-cancel {
      padding: 8px 15px;
      border: none;
      border-radius: 4px;
      color: white;
  }
  .btn-invoice {
      background-color: #6c757d;
  }
  .btn-cancel {
      background-color: #dc3545;
  }
  .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 10px;
  }
  .pagination button {
      border: 1px solid #dee2e6;
      background: white;
      padding: 5px 10px;
      border-radius: 4px;
  }
  .pagination button.active {
      background: #007bff;
      color: white;
      border-color: #007bff;
  }
</style>

{% endblock %}
