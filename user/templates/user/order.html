{% extends "user/base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/order.css' %}">

<div class="container py-4">

  {% if messages %}
  <div class="alert alert-dismissible fade show" role="alert">
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
      {% endfor %}
  </div>
  {% endif %}

  <div class="row">
      <!-- Sidebar -->
      <div class="col-md-3">
          <div class="sidebar">
              <h5>Account</h5>
              <ul class="sidebar-menu">
                  <li><a href="{% url 'myprofile' %}">Profile</a></li>
                  <li><a href="{% url 'address' %}">Addresses</a></li>
                  <li><a href="{% url 'myorder' %}" class="active">Orders</a></li>
                  <li><a href="{% url 'wallet' %}">Wallet</a></li>
                  <li><a href="{% url 'coupon' %}">Coupon</a></li>
                  <li><a href="{% url 'user_changepass' %}">Change Password</a></li>
              </ul>
              <button class="logout-btn">LOGOUT</button>
          </div>
      </div>

      <!-- Main Content -->
      <div class="col-md-9">
          <div class="main-content">
              <h2>My Orders</h2>

              <!-- Order Filters -->
              <form method="GET">
                  <div class="order-filters">
                    <label>
                      <input type="radio" name="status" value="Delivered" {% if request.GET.status == 'Delivered' %}checked{% endif %}> All
                  </label>
                      <label>
                          <input type="radio" name="status" value="Delivered" {% if request.GET.status == 'Delivered' %}checked{% endif %}> Delivered
                      </label>
                      <label>
                          <input type="radio" name="status" value="Cancelled" {% if request.GET.status == 'Cancelled' %}checked{% endif %}> Cancelled
                      </label>
                      <label>
                          <input type="radio" name="status" value="Returned" {% if request.GET.status == 'Returned' %}checked{% endif %}> Returned
                      </label>
                      <a href="{% url 'myorder' %}" class="clear-filter">Clear all</a>
                  </div>
                  
              </form>

              <!-- Order List -->
              {% for order in orders %}
              <div class=" order-container">
                  <div class="order-items">
                      {% for item in order.items.all %}
                <a style="list-style-type: none; text-decoration: none;" href="{% url 'orderview' order.id  %}">
                      <div class="item-row">

                       
                        <img src="{{ item.product_variant.productimage_set.first.image_path.url }}" 
                            alt="{{ item.product_variant.product.name }}" class="item-image">
                       
                          <div class="item-details">
                              <div class="item-name">{{ item.product_variant.product.name }}</div>
                              
                          </div>
                      </div>
                </a>
                      {% endfor %}
                  </div>
                  <div class="order-info">
                      <div>
                          <p>Order Placed: {{ order.created_at|date:"M d Y" }}</p>
                          <p>Status: <span 
                            style="
                                {% if order.status == 'pending' %}color: brown;
                                {% elif order.status == 'shipped' %}color: blue;
                                {% elif order.status == 'delivered' %}color: green;
                                {% elif order.status == 'cancelled' %}color: red;
                                {% elif order.status == 'return_pending' %}color: orange;
                                {% elif order.status == 'return_approved' %}color: green;
                                {% elif order.status == 'return_rejected' %}color: red;
                                {% endif %}
                                font-weight: bold;">
                            {{ order.status|title }}
                        </span></p>
                        
                        {% if order.status == "delivered" %}
                        <a href="#" class="btn btn-primary">Download Invoice</a>
                        {% endif %}
                      </div>
                      
                      <div>
                          <p>Order ID: #{{ order.id }}</p>
                          <p>Total Price: â‚¹{{ order.total_price }}</p>
                      </div>
                  </div>

                  <div class="order-actions">
                    {% if order.status == "pending" or order.status == "processing" or order.status == "shipped" %}
                        <button class="btn-cancel" data-bs-toggle="modal" data-bs-target="#cancelOrderModal{{ order.id }}">
                            Cancel Order
                        </button>
                    {% elif order.status == "delivered" and not order.return_reason %}
                        <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#returnOrderModal{{ order.id }}">
                            Return Order
                        </button>
                    {% endif %}
                </div>
              </div>
              {% endfor %}

              <!-- Cancel Order Modal -->
              {% for order in orders %}
              <div class="modal fade" id="cancelOrderModal{{ order.id }}" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                      <form method="POST" action="{% url 'cancel_order' order.id %}">
                          {% csrf_token %}
                          <div class="modal-content">
                              <div class="modal-header">
                                  <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                  <div class="mb-3">
                                      <label for="cancellation_reason" class="form-label">Cancellation Reason</label>
                                      <textarea class="form-control" id="cancellation_reason" name="cancellation_reason" rows="3" required></textarea>
                                  </div>
                              </div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                  <button type="submit" class="btn btn-danger">Cancel Order</button>
                              </div>
                          </div>
                      </form>
                  </div>
              </div>


            <!-- Return Order Modal -->
            <div class="modal fade" id="returnOrderModal{{ order.id }}" tabindex="-1" aria-labelledby="returnOrderModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <form method="POST" action="{% url 'order_return' order.id %}">
                        {% csrf_token %}
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="returnOrderModalLabel">Return Order</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="return_reason_{{ order.id }}" class="form-label">Mention your Reason...</label>
                                    <textarea class="form-control" id="return_reason_{{ order.id }}" name="return_reason" rows="3" required></textarea>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-info">Submit Return Request</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            {% endfor %}
              

              
             
          </div>
<!-- Pagination -->
          <nav aria-label="Product navigation" class="mt-4">
            <ul class="pagination">
                <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link" href="#">Next</a></li>
            </ul>
        </nav>
      </div>
  </div>
</div>


{% endblock %}
