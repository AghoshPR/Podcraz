{% extends "user/base.html" %}
{% load static %}
{% block content %}

<link rel="stylesheet" href="{% static 'css/orderview.css' %}">

</head>
<body>


<!-- Main Content -->
<div class="container py-4">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 mb-4">
            <div class="sidebar">
                <h5 class="mb-4">Account</h5>
                <nav class="nav flex-column">
                    <a class="nav-link" href="{% url 'myprofile' %}"><i class="fas fa-user me-2"></i>Profile</a>
                    <a class="nav-link" href="{% url 'address' %}"><i class="fas fa-map-marker-alt me-2"></i>Addresses</a>
                    <a class="nav-link active" href="{% url 'myorder' %}"><i class="fas fa-box me-2"></i>Orders</a>
                    <a class="nav-link" href="#"><i class="fas fa-wallet me-2"></i>Wallet</a>
                    <a class="nav-link" href="#"><i class="fas fa-ticket me-2"></i>Coupon</a>
                    <a class="nav-link" href="#"><i class="fas fa-lock me-2"></i>Change Password</a>
                </nav>
                <button class="btn btn-danger mt-4 w-100">Logout</button>
            </div>
        </div>

        <!-- Order Details -->
        <div class="col-md-9">
            <div class="order-card">
                <div class="row">
                    {% for item in order.items.all %}
                    <div class="col-md-3">
                        <img src="{{ item.product_variant.productimage_set.first.image_path.url }}" alt="{{ item.product_variant.product.name }}" class="product-img img-fluid">
                    </div>
                    <div class="col-md-5">
                        <h6 class="text-muted">Order ID: #{{ order.id }} </h6>
                        <h5 class="mb-3">{{ item.product_variant.product.name }}</h5>
                        <p>Quantity: {{ item.quantity }}</p>
                        <p>Price: ₹{{ item.price }}</p>
                        <hr>
                        
                    </div>
                    
                    <div class="col-md-4">
                        <div class="order-summary">
                            
                            
                        </div>
                    </div>
                    {% endfor %}
                </div>
            
                <!-- Show Delivery Charge only once for the entire order -->
                <div class="order-summary">
                    <p class="d-flex justify-content-between mb-2">
                        <span>Delivery Charge:</span>
                        <strong>₹0</strong>
                    </p>
                    <p class="d-flex justify-content-between mb-2">
                        <span>Platform Fee:</span>
                        <strong>₹0</strong>
                    </p>


                    {% if order.discount > 0 %}
                    <p class="d-flex justify-content-between mb-2">
                        <span>Original Price:</span>
                        <strong >₹ {{ order.subtotal }}</strong>
                    </p>
                    <p class="d-flex justify-content-between mb-2">
                        <span>Discount Applied:</span>
                        <strong style="color: #28a745;"> ₹ {{ order.discount }} -</strong>
                    </p>
                    {% endif %}
                    
                    <p class="d-flex justify-content-between mb-2">
                        <span>Total Order Price:</span>
                        <strong>₹{{ order.total_price }} /-</strong>
                    </p>

                    <p class="mb-2"><strong>Mode of Payment:</strong> {{ order.payment_method.name }}</p>
                    <p class="mb-0"><strong>Delivery Address:</strong><br>
                        {{ order.address.address }}<br>
                        {{ order.address.city }}, {{ order.address.state }} - {{ order.address.pin_code }}<br>
                        Phone: {{ order.address.phone }}
                    </p>
                </div>
            </div>
            
            

            
            <!-- Order Status -->
           
        <div class="order-card">
            <h5 class="mb-4">Order Status</h5>
            <div class="status-tracker">
                <div class="progress">
                    <!-- Adjust progress width based on current order status -->
                    <div class="progress-bar 
                        {% if order.status == 'cancelled' %}bg-danger
                        {% elif order.status == 'delivered' %}bg-success
                        {% elif order.status == 'shipped' %}bg-primary
                        {% elif order.status == 'processing' %}bg-warning
                        {% else %}bg-secondary{% endif %}" 
                        role="progressbar" 
                        style="width: 
                        {% if order.status == 'processing' %}33%
                        {% elif order.status == 'shipped' %}66%
                        {% elif order.status == 'delivered' %}100%
                        {% elif order.status == 'cancelled' %}0%
                        {% else %}0%{% endif %}">
                    </div>
                </div>
                <div class="row text-center">
                    <!-- Processing -->
                    <div class="col-3 status-step">
                        <div class="status-circle {% if order.status in possible_statuses.processing %}completed{% endif %}">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="status-label">Processing</div>
                    </div>
                    <div class="col-3 status-step">
                        <div class="status-circle {% if order.status in possible_statuses.shipped %}completed{% endif %}">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="status-label">Shipped</div>
                    </div>
                    <div class="col-3 status-step">
                        <div class="status-circle {% if order.status in possible_statuses.delivered %}completed{% endif %}">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="status-label">Delivered</div>
                    </div>
                    <div class="col-3 status-step">
                        <div class="status-circle {% if order.status in possible_statuses.cancelled %}completed cancelled{% endif %}">
                            <i class="fas fa-times"></i>
                        </div>
                        <div class="status-label">Cancelled</div>
                    </div>
                </div>
            </div>
        </div>






        </div>
    </div>
</div>
   

{% endblock %}
